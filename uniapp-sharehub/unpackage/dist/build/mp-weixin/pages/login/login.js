(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{3267:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=t("2450"),a={data:function(){return{loggedIn:!1,loading:!1,nickName:"未登录",headerUrl:"http://web-showhub.oss-cn-beijing.aliyuncs.com/users/default.png",userTagsPreferId:""}},onLoad:function(){},computed:{titleClass:function(){return this.loggedIn?"text-area title text-blue":"text-area title text-red"}},methods:{login:function(){var n=this;e.showModal({mask:!0,title:"温馨提示",content:"确定要微信授权登录小程序吗？",success:function(t){t.confirm?(n.loading=!0,e.getUserProfile({desc:"获取你的昵称、头像",success:function(t){if("getUserProfile:ok"==t.errMsg&&void 0!=t.userInfo){var o={avatarUrl:t.userInfo.avatarUrl,nickName:t.userInfo.nickName};n.getUserOpenId(o)}else e.showToast({icon:"none",title:"获取失败，请重试"})},fail:function(e){}})):t.cancel}})},getUserOpenId:function(n){var t=this;e.login({provider:"weixin",success:function(n){var a={code:n.code};e.request({url:"http://localhost:8080/user/login",method:"POST",data:a,success:function(n){if(t.loading=!1,1==n.data.code){e.showToast({title:"登录成功！",icon:"success",duration:500});var a=n.data.data,r=(0,o.jwtDecode)(a);t.nickName=r.username,t.headerUrl=r.image,t.userTagsPreferId=r.userTagsPreferId,e.setStorage({key:"token",data:a,success:function(){}}),t.$store.commit("user/setUsername",r.username),t.$store.commit("user/setOpenid",r.openId),console.log("Vuex中存储的用户姓名：",t.$store.state.user.username),console.log("Vuex中存储的openid：",t.$store.state.user.openid),t.loggedIn=!0}else e.showToast({title:"登录失败！",icon:"none",duration:2e3})},fail:function(n){console.error("请求失败",n),t.loading=!1,e.showToast({title:"登录失败！",icon:"none",duration:2e3})}})}})},switchTab:function(){var n="";null!==this.userTagsPreferId&&""!==this.userTagsPreferId?(n="/pages/home/home",e.switchTab({url:n})):(n="/pages/home/home_prefer/home_prefer",e.navigateTo({url:n}))}}};n.default=a}).call(this,t("543d")["default"])},"43a1":function(e,n,t){"use strict";(function(e,n){var o=t("4ea4");t("f4b8");o(t("66fd"));var a=o(t("684d"));e.__webpack_require_UNI_MP_PLUGIN__=t,n(a.default)}).call(this,t("bc2e")["default"],t("543d")["createPage"])},"56b6":function(e,n,t){},"684d":function(e,n,t){"use strict";t.r(n);var o=t("b601"),a=t("be5f");for(var r in a)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return a[e]}))}(r);t("6d6a");var s=t("f0c5"),i=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=i.exports},"6d6a":function(e,n,t){"use strict";var o=t("56b6"),a=t.n(o);a.a},b601:function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return r})),t.d(n,"a",(function(){return o}));var o={uvLoadingPage:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uv-loading-page/components/uv-loading-page/uv-loading-page")]).then(t.bind(null,"a29f"))}},a=function(){var e=this.$createElement;this._self._c},r=[]},be5f:function(e,n,t){"use strict";t.r(n);var o=t("3267"),a=t.n(o);for(var r in o)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(r);n["default"]=a.a}},[["43a1","common/runtime","common/vendor"]]]);